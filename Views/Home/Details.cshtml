@model IEnumerable<DivarClone.Models.Listing>


<style>
    figure.zoom {
        position: relative;
        overflow: hidden;
        cursor: zoom-in;
        background-size: 0; /* Hide background initially */
        background-repeat: no-repeat;
        background-position: center;
        transition: transform 0.8s, background-size 0.8s ease-in-out;
    }

    figure.zoom img {
        width: 100%;
        height: 500px;
        object-fit: contain;
        transition: opacity 0.8s, transform 0.8s ease-in-out;
        display: none; 
    }

    figure.zoom.active {
        transform: scale(1.5);
        background-size: 150%;
    }

    figure.zoom.active img {
        opacity: 0; 
    }
</style>

@foreach (var listing in Model)
{
    int listingId = @listing.Id;

    <h2>@listing.Name</h2>

    <div>
        <p>@listing.Description</p>
        <p>Price: @listing.Price</p>
        <p>Category: @listing.Category</p>
        <p>Posted by: @listing.Poster</p>
        <p>Date of Posting: @listing.DateTimeOfPosting.ToString("MM/dd/yyyy HH:mm:ss")</p>

        <div>
            @if (listing.ImageData != null && listing.ImageData.Any())
            {
                @if (listing.ImageData.Count > 1)
                {
                    @foreach (var image in listing.ImageData)
                    {
                        <figure class="zoom" onclick="toggleZoom(this)" id="listing-img-figure-@listing.Id" style="background-image: url('@image');">
                            <img class="mySlides-@listing.Id" src="@image" alt="no img"/>
                        </figure>
                    }
                    <button class="w3-button w3-display-left" onclick="plusDivs(-1, @listingId)">&#10094;</button>
                    <button class="w3-button w3-display-right" onclick="plusDivs(+1, @listingId)">&#10095;</button>

                    <script>
                        document.querySelector(".mySlides-@listing.Id").style.display = "block";
                    </script>
                }
                else
                {
                    <img src="@listing.ImageData[0]" alt="no img" />
                }
            }
            else
            {
                <p>No images available</p>
            }
        </div>
    </div>
    <script>
        var slideIndex = 1;

        showDivs(slideIndex, listingId);

        function plusDivs(n, listingId) {
            showDivs(slideIndex += n, listingId);
        }

        function showDivs(n, listingId) {
            var i;
            var slides = document.getElementsByClassName("mySlides-" + listingId);

            if (n > slides.length) { slideIndex = 1; }
            if (n < 1) { slideIndex = slides.length; }

            for (i = 0; i < slides.length; i++) {
                slides[i].style.display = "none";
            }
            slides[slideIndex - 1].style.display = "block";
        }

        function toggleZoom(element) {
            element.classList.toggle('active'); // Toggle the 'active' class to trigger the zoom effect

            // If zoom is activated (active class added), add the mousemove listener
            if (element.classList.contains('active')) {
                element.addEventListener('mousemove', zoom);
            } else {
                element.removeEventListener('mousemove', zoom); // Remove the listener when zoom is deactivated
            }
        }

        function zoom(e) {
            var zoomer = e.currentTarget;
            var offsetX, offsetY;

            if (e.offsetX) {
                offsetX = e.offsetX;
                offsetY = e.offsetY;
            } else if (e.touches) {
                offsetX = e.touches[0].pageX - zoomer.offsetLeft;
                offsetY = e.touches[0].pageY - zoomer.offsetTop;
            }

            var x = (offsetX / zoomer.offsetWidth) * 100;
            var y = (offsetY / zoomer.offsetHeight) * 100;
            zoomer.style.backgroundPosition = x + '% ' + y + '%';
            console.log(zoomer.style.backgroundPosition);
        }
    </script>
}

